# =============================================================================
# SAFETY-02: Crisis Contacts on Profile Screen
# CRITICAL — FDA SaMD / HIPAA safety-critical test.
# Verifies that the Profile tab contains a dedicated Crisis Resources card
# displaying both 988 (Suicide & Crisis Lifeline) and 741741 (Crisis Text
# Line). This provides a second always-accessible path to crisis contacts.
# =============================================================================
appId: com.mindlog.app

---

# Launch with a clean slate
- launchApp:
    clearState: true

# Connect to Metro dev server (Expo Dev Client)
- runFlow: ../../subflows/connect_dev_server.yaml

# Sign in as the demo patient
- runFlow: ../../subflows/sign_in.yaml

# Navigate to the Profile tab
- tapOn:
    text: "Profile"

# Wait for Profile screen to load
- extendedWaitUntil:
    visible:
      text: "Profile"
    timeout: 8000

# Scroll down to reveal the crisis resources card
- scrollUntilVisible:
    element:
      id: "profile-crisis-card"
    direction: DOWN
    timeout: 10000

# ── MANDATORY: Crisis card visible ─────────────────────────────────────────
- assertVisible:
    id: "profile-crisis-card"

# ── MANDATORY: "Crisis Resources" heading ──────────────────────────────────
- extendedWaitUntil:
    visible:
      text: "Crisis Resources"
    timeout: 5000

# ── MANDATORY: 988 Suicide & Crisis Lifeline ──────────────────────────────
- extendedWaitUntil:
    visible:
      text: "988"
    timeout: 5000

# ── MANDATORY: 741741 Crisis Text Line ────────────────────────────────────
- extendedWaitUntil:
    visible:
      text: "741741"
    timeout: 5000

- takeScreenshot: screenshots/safety_profile_crisis
