# =============================================================================
# SAFETY-01: Crisis Contacts on Today Screen
# CRITICAL — FDA SaMD / HIPAA safety-critical test.
# Verifies that the Today screen always displays the safety card with both
# crisis contact numbers: 988 (Suicide & Crisis Lifeline) and 741741 (Crisis
# Text Line). These MUST be visible to every authenticated patient.
# =============================================================================
appId: com.mindlog.app

---

# Launch with a clean slate
- launchApp:
    clearState: true

# Connect to Metro dev server (Expo Dev Client)
- runFlow: ../../subflows/connect_dev_server.yaml

# Sign in as the demo patient
- runFlow: ../../subflows/sign_in.yaml

# Confirm Today screen loaded
- extendedWaitUntil:
    visible:
      text: "Good"
    timeout: 10000

# Scroll to the bottom of the Today screen to reveal the safety card
- scrollUntilVisible:
    element:
      id: "today-safety-card"
    direction: DOWN
    timeout: 10000

# ── MANDATORY: Safety card visible ─────────────────────────────────────────
- assertVisible:
    id: "today-safety-card"

# ── MANDATORY: Safety prompt text ──────────────────────────────────────────
- extendedWaitUntil:
    visible:
      text: "Need immediate support?"
    timeout: 5000

# ── MANDATORY: 988 Suicide & Crisis Lifeline ──────────────────────────────
- extendedWaitUntil:
    visible:
      text: "988"
    timeout: 5000

# ── MANDATORY: 741741 Crisis Text Line ────────────────────────────────────
- extendedWaitUntil:
    visible:
      text: "741741"
    timeout: 5000

- takeScreenshot: screenshots/safety_today_crisis
